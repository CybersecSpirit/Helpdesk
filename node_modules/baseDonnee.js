
const mysql = require('mysql');

var con = mysql.createConnection({
host: "localhost",
port: "3141",
user: "",
password: "",
database: "helpdesk"
});

class DataBase {
  constructor() {

  }
  newTopic(nom, mag, service, msgtxt){
    con.connect(function(err) {
      if (err) throw err;
      console.log("Connecté !");
      var sql = "INSERT INTO topic (nom, service, magasin, msgtxt) VALUES ('" + nom + "','"+ service +"','"+ mag +"','"+ msgtxt +"')";
      con.query(sql, function(err, result){
        if (err) throw err;
        console.log('Transmis')
        });
      });
  }

newMessage(idtopic, msgtxt){
    con.connect(function(err) {
      if (err) throw err;
      console.log("Connecté !");
      var sql = "INSERT INTO message (idtopic, message) VALUES ('" + idtopic + "','"+ msgtxt +"')";
        con.query(sql, function(err, result){
          if (err) throw err;
          console.log('Transmis')
        });
      });
    }
  getMessage(idTopic){
    con.connect(function(err) {
      if (err) throw err;
      console.log("Connecté !");
      var sql = "SELECT * FROM message WHERE  idtopic = '" + idTopic + "'";
        con.query(sql, function(err, result){
          if (err) throw err;
          return result;
        });
      });
  }
  getTopicMagasin(magasin, res){
    con.connect(function(err) {
      if (err) throw err;
      console.log("Connecté !")
    });
      var sql = "SELECT * FROM topic WHERE  magasin = '" + magasin + "'";
      con.query(sql, function(err, result){
          if (err) throw err;
          res.render('viewClient.ejs',{magasin : magasin, tickets: result});
        });
        con.end();

  }
  getTopicService(service){
    con.connect(function(err) {
      if (err) throw err;
      console.log("Connecté !");
      var sql = "SELECT * FROM topic WHERE  service = '" + service + "'";
        con.query(sql, function(err, result){
          if (err) throw err;
          return result;
        });
      });
  }
};
module.exports = DataBase;
